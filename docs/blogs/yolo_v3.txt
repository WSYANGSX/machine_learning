https://blog.csdn.net/qq_34199326/article/details/84072505


åœ¨ç›®æ ‡æ£€æµ‹ä¸­ï¼ˆå¦‚YOLOã€Faster R-CNNã€SSDç­‰ï¼‰ï¼Œå¯¹è¾¹ç•Œæ¡†å®½åº¦ w å’Œé«˜åº¦ h çš„é¢„æµ‹å€¼è¿›è¡Œå¯¹æ•°ç©ºé—´å˜æ¢ï¼ˆé€šå¸¸æŒ‡å–è‡ªç„¶å¯¹æ•°ï¼‰æ˜¯ä¸€ä¸ªå…³é”®çš„è®¾è®¡é€‰æ‹©ã€‚å…¶ä¸»è¦ç›®çš„å’Œå¥½å¤„å¦‚ä¸‹ï¼š

ðŸ“Œ æ ¸å¿ƒå¥½å¤„æ€»ç»“
æ•°å€¼ç¨³å®šæ€§ä¸Žå°ºåº¦ä¸å˜æ€§ï¼š ä½¿æ¨¡åž‹æ›´å®¹æ˜“å­¦ä¹ å’Œå¤„ç†ä¸åŒå°ºåº¦çš„ç›®æ ‡ã€‚

æŸå¤±å‡½æ•°å‡è¡¡ï¼š ä½¿æŸå¤±å‡½æ•°å¯¹å°ç›®æ ‡å’Œå¤§ç›®æ ‡çš„é¢„æµ‹è¯¯å·®æ›´å…¬å¹³ã€‚

æ¢¯åº¦è¡Œä¸ºä¼˜åŒ–ï¼š æä¾›æ›´å¹³æ»‘ã€æ›´æ˜“äºŽä¼˜åŒ–çš„æ¢¯åº¦ã€‚

ç¬¦åˆç‰©ç†æ„ä¹‰ï¼š é¢„æµ‹çš„æ˜¯ç›¸å¯¹äºŽé”šæ¡†ï¼ˆAnchor Boxï¼‰çš„æ¯”ä¾‹ç¼©æ”¾å› å­ã€‚

ðŸ“– è¯¦ç»†è§£é‡Š
å¤„ç†å¤§åŠ¨æ€èŒƒå›´ï¼Œå®žçŽ°å°ºåº¦ä¸å˜æ€§ï¼š

å›¾åƒä¸­çš„ç›®æ ‡å°ºå¯¸å·®å¼‚å·¨å¤§ï¼ˆä»Žå‡ ä¸ªåƒç´ çš„å°ç‰©ä½“åˆ°å æ®å¤§éƒ¨åˆ†å›¾åƒçš„å¤§ç‰©ä½“ï¼‰ã€‚w å’Œ h çš„åŽŸå§‹å€¼èŒƒå›´å¯èƒ½ä»Ž 10 åˆ° 1000+ã€‚

ç›´æŽ¥è®©ç¥žç»ç½‘ç»œé¢„æµ‹å¦‚æ­¤å¤§èŒƒå›´çš„å€¼ï¼ˆå°¤å…¶æ˜¯ç»å¯¹å€¼ï¼‰éžå¸¸å›°éš¾ã€‚ç¥žç»ç½‘ç»œé€šå¸¸å¯¹è¾“å…¥/è¾“å‡ºçš„å°ºåº¦æ•æ„Ÿï¼Œä¸åŒå°ºåº¦çš„ç›®æ ‡ä¼šå¯¼è‡´æŸå¤±å‡½æ•°ä¸­ä¸åŒé¡¹çš„é‡çº§å·®å¼‚å·¨å¤§ã€‚

å¯¹æ•°å˜æ¢ (log(w), log(h)) å°†åŽŸæœ¬å‘ˆæŒ‡æ•°å¢žé•¿çš„å¤§æ•°å€¼èŒƒå›´åŽ‹ç¼©åˆ°ä¸€ä¸ªç›¸å¯¹è¾ƒå°çš„çº¿æ€§èŒƒå›´å†…ï¼ˆä¾‹å¦‚ log(10)â‰ˆ2.3, log(1000)â‰ˆ6.9ï¼‰ã€‚è¿™ä½¿å¾—ç¥žç»ç½‘ç»œæ›´å®¹æ˜“å­¦ä¹ å’Œæ³›åŒ–åˆ°ä¸åŒå°ºåº¦çš„ç›®æ ‡ã€‚

å‡è¡¡æŸå¤±å‡½æ•°ï¼ˆLoss Balancingï¼‰ï¼š

è€ƒè™‘ä½¿ç”¨å‡æ–¹è¯¯å·® (MSE) æŸå¤±ï¼šL = (w_pred - w_true)Â² + (h_pred - h_true)Â²ã€‚

å¦‚æžœç›´æŽ¥é¢„æµ‹åŽŸå§‹ w, hï¼š

å¯¹äºŽä¸€ä¸ªå¤§ç›®æ ‡ï¼ˆä¾‹å¦‚ w_true=200ï¼‰ï¼Œé¢„æµ‹å€¼å·® 10 åƒç´ ï¼ˆw_pred=210ï¼‰äº§ç”Ÿçš„æŸå¤±æ˜¯ (210-200)Â² = 100ã€‚

å¯¹äºŽä¸€ä¸ªå°ç›®æ ‡ï¼ˆä¾‹å¦‚ w_true=20ï¼‰ï¼ŒåŒæ ·å·® 10 åƒç´ ï¼ˆw_pred=30ï¼‰äº§ç”Ÿçš„æŸå¤±ä¹Ÿæ˜¯ (30-20)Â² = 100ã€‚

é—®é¢˜åœ¨äºŽï¼š10 åƒç´ çš„è¯¯å·®å¯¹äºŽ 200 åƒç´ çš„ç›®æ ‡ï¼ˆç›¸å¯¹è¯¯å·® 5%ï¼‰é€šå¸¸æ˜¯å¯ä»¥æŽ¥å—çš„ï¼Œä½†å¯¹äºŽ 20 åƒç´ çš„ç›®æ ‡ï¼ˆç›¸å¯¹è¯¯å·® 50%ï¼‰æ˜¯ç¾éš¾æ€§çš„ã€‚æŸå¤±å‡½æ•°å´èµ‹äºˆå®ƒä»¬ç›¸åŒçš„æƒ©ç½šã€‚å¤§ç›®æ ‡çš„ç»å¯¹è¯¯å·®ä¸»å¯¼äº†æŸå¤±å‡½æ•°ï¼Œå°ç›®æ ‡çš„ç›¸å¯¹è¯¯å·®è¢«æ·¹æ²¡ã€‚

å¯¹æ•°å˜æ¢åŽé¢„æµ‹ (t_w = log(w_pred / w_anchor), t_h = log(h_pred / h_anchor))ï¼š

æŸå¤±å‡½æ•°å˜ä¸º L = (t_w_pred - t_w_true)Â² + (t_h_pred - t_h_true)Â²ã€‚

t_w_true = log(w_true / w_anchor)ï¼Œt_h_true = log(h_true / h_anchor)ã€‚

ç”±äºŽ log(a) - log(b) = log(a/b)ï¼Œè¯¯å·®é¡¹ (t_w_pred - t_w_true) å®žè´¨ä¸Šæ˜¯ log((w_pred / w_anchor) / (w_true / w_anchor)) = log(w_pred / w_true)ã€‚

è¿™ä¸ªè¯¯å·® log(w_pred / w_true) è¡¡é‡çš„æ˜¯é¢„æµ‹å®½åº¦ä¸ŽçœŸå®žå®½åº¦çš„ æ¯”å€¼ çš„å¯¹æ•°ã€‚å®ƒå¤©ç„¶åœ°å…³æ³¨ç›¸å¯¹è¯¯å·®ã€‚

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼š

å¤§ç›®æ ‡ï¼šlog(210/200) â‰ˆ log(1.05) â‰ˆ 0.0488ï¼Œå¹³æ–¹æŸå¤± â‰ˆ 0.00238

å°ç›®æ ‡ï¼šlog(30/20) â‰ˆ log(1.5) â‰ˆ 0.4055ï¼Œå¹³æ–¹æŸå¤± â‰ˆ 0.1644

çŽ°åœ¨ï¼Œå°ç›®æ ‡ï¼ˆç›¸å¯¹è¯¯å·®å¤§ï¼‰çš„æŸå¤±æ˜¾è‘—å¤§äºŽå¤§ç›®æ ‡ï¼ˆç›¸å¯¹è¯¯å·®å°ï¼‰çš„æŸå¤±ã€‚è¿™æ›´ç¬¦åˆæ£€æµ‹ä»»åŠ¡çš„éœ€æ±‚ï¼Œä½¿æŸå¤±å‡½æ•°å¯¹å°ç›®æ ‡çš„é¢„æµ‹è¯¯å·®æ›´æ•æ„Ÿã€‚è®­ç»ƒè¿‡ç¨‹ä¼šå› æ­¤æ›´ä¸“æ³¨äºŽæé«˜å°ç›®æ ‡çš„é¢„æµ‹ç²¾åº¦ã€‚

ä¼˜åŒ–æ¢¯åº¦è¡Œä¸ºï¼š

ç›´æŽ¥é¢„æµ‹å¤§èŒƒå›´çš„åŽŸå§‹å€¼ w, h ä¼šå¯¼è‡´æŸå¤±å‡½æ•°çš„æ¢¯åº¦å¤§å°ä¹Ÿå·®å¼‚å·¨å¤§ã€‚å¤§ç›®æ ‡çš„æ¢¯åº¦å¯èƒ½éžå¸¸å¤§ï¼Œå°ç›®æ ‡çš„æ¢¯åº¦å¯èƒ½éžå¸¸å°ã€‚è¿™ç§ä¸å¹³è¡¡çš„æ¢¯åº¦ä¼šä½¿ä¼˜åŒ–è¿‡ç¨‹ï¼ˆå¦‚SGDï¼‰ä¸ç¨³å®šï¼Œéš¾ä»¥é€‰æ‹©åˆé€‚çš„å…¨å±€å­¦ä¹ çŽ‡ã€‚

å¯¹æ•°å˜æ¢åŽ‹ç¼©äº†ç›®æ ‡å€¼çš„èŒƒå›´ï¼Œä½¿å¾—é¢„æµ‹å€¼ (t_w, t_h) çš„å°ºåº¦ç›¸å¯¹ä¸€è‡´ã€‚è¿™é€šå¸¸ä¼šå¯¼è‡´æŸå¤±å‡½æ•°å…³äºŽ t_w, t_h çš„æ¢¯åº¦æ›´åŠ å‡åŒ€å’Œå¯æŽ§ï¼Œä½¿ä¼˜åŒ–è¿‡ç¨‹æ›´ç¨³å®šã€æ›´å®¹æ˜“æ”¶æ•›ã€‚

ç¬¦åˆç‰©ç†æ„ä¹‰ - é¢„æµ‹ç¼©æ”¾å› å­ï¼š

æ¨¡åž‹å®žé™…é¢„æµ‹çš„ä¸æ˜¯ç»å¯¹çš„ w, hï¼Œè€Œæ˜¯ç›¸å¯¹äºŽé¢„è®¾é”šæ¡†ï¼ˆAnchor Boxï¼‰å°ºå¯¸ (w_anchor, h_anchor) çš„ç¼©æ”¾å› å­ã€‚

å®šä¹‰ç½‘ç»œè¾“å‡º (t_w, t_h)ï¼š
t_w = log(w_pred / w_anchor)
t_h = log(h_pred / h_anchor)

åœ¨æŽ¨ç†æ—¶ï¼Œé€šè¿‡æŒ‡æ•°å˜æ¢è¿˜åŽŸé¢„æµ‹æ¡†å°ºå¯¸ï¼š
w_pred = w_anchor * exp(t_w)
h_pred = h_anchor * exp(t_h)

è¿™ç§è®¾è®¡å…·æœ‰æ¸…æ™°çš„ç‰©ç†æ„ä¹‰ï¼š

t_w = 0 (exp(0)=1) è¡¨ç¤ºé¢„æµ‹å®½åº¦ w_pred ç­‰äºŽé”šæ¡†å®½åº¦ w_anchorã€‚

t_w > 0 (exp(t_w) > 1) è¡¨ç¤ºé¢„æµ‹å®½åº¦æ¯”é”šæ¡†å®½ã€‚

t_w < 0 (exp(t_w) < 1) è¡¨ç¤ºé¢„æµ‹å®½åº¦æ¯”é”šæ¡†çª„ã€‚

æ¨¡åž‹åªéœ€å­¦ä¹ ä¸€ä¸ªè¿žç»­çš„ç¼©æ”¾ç³»æ•° exp(t_w), exp(t_h)ã€‚è¿™æ¯”ç›´æŽ¥é¢„æµ‹ä¸€ä¸ªä»»æ„çš„ç»å¯¹å°ºå¯¸ w, h æ›´å®¹æ˜“ã€æ›´ç¬¦åˆé”šæ¡†æœºåˆ¶çš„åˆè¡·ï¼ˆé”šæ¡†æä¾›äº†ç›®æ ‡å°ºå¯¸çš„å…ˆéªŒï¼‰ã€‚

ðŸ“Š ä¸ºä»€ä¹ˆæ˜¯â€œå¯¹æ•°ç©ºé—´â€è€Œä¸æ˜¯å…¶ä»–åŽ‹ç¼©æ–¹æ³•ï¼Ÿ
å¯é€†æ€§ï¼š å¯¹æ•°å˜æ¢ (log) å’ŒæŒ‡æ•°å˜æ¢ (exp) æ˜¯äº’é€†çš„ï¼Œå¯ä»¥æ— æŸåœ°åœ¨åŽŸå§‹ç©ºé—´å’Œå˜æ¢ç©ºé—´ä¹‹é—´è½¬æ¢ã€‚

æ¢¯åº¦ç‰¹æ€§ï¼š æŒ‡æ•°å‡½æ•°çš„å¯¼æ•° d(exp(x))/dx = exp(x) ä¿è¯äº†è¿˜åŽŸè®¡ç®—æ—¶çš„æ¢¯åº¦ä¼ æ’­æ˜¯å¯è¡Œçš„ã€‚

ä¹˜æ³•å˜åŠ æ³•ï¼š log(a*b) = log(a) + log(b)ï¼Œè¿™ç§æ€§è´¨ä½¿å¾—å¤„ç†ç›¸å¯¹æ¯”ä¾‹ï¼ˆç¼©æ”¾å› å­ï¼‰éžå¸¸è‡ªç„¶å’Œæ–¹ä¾¿ã€‚

å¤„ç†æ­£å®žæ•°ï¼š w, h æ˜¯ä¸¥æ ¼çš„æ­£å®žæ•°ï¼Œå¯¹æ•°å˜æ¢å¤©ç„¶é€‚ç”¨äºŽæ­£å®žæ•°åŸŸã€‚

ðŸ“Ž æ€»ç»“
å°†å¯¹è¾¹ç•Œæ¡†ç»´åº¦ (w, h) çš„é¢„æµ‹æ˜ å°„åˆ°å¯¹æ•°ç©ºé—´çš„æ ¸å¿ƒå¥½å¤„åœ¨äºŽï¼šå°†é¢„æµ‹é—®é¢˜ä»Žé¢„æµ‹å¤§èŒƒå›´ã€ç»å¯¹å°ºå¯¸çš„å›°éš¾ä»»åŠ¡ï¼Œè½¬åŒ–ä¸ºé¢„æµ‹ç›¸å¯¹é”šæ¡†å°ºå¯¸çš„ã€å°ºåº¦å½’ä¸€åŒ–çš„ç¼©æ”¾å› å­ï¼ˆå¯¹æ•°å½¢å¼ï¼‰çš„æ›´å®¹æ˜“çš„ä»»åŠ¡ã€‚ è¿™ç§å˜æ¢ï¼š

åŽ‹ç¼©åŠ¨æ€èŒƒå›´ï¼Œä½¿ä¸åŒå°ºåº¦ç›®æ ‡çš„é¢„æµ‹å€¼å¤„äºŽç›¸è¿‘é‡çº§ã€‚

ä½¿æŸå¤±å‡½æ•°å…³æ³¨ç›¸å¯¹è¯¯å·®ï¼Œå¹³è¡¡äº†å°ç›®æ ‡å’Œå¤§ç›®æ ‡é¢„æµ‹è¯¯å·®å¯¹æ€»æŸå¤±çš„è´¡çŒ®ï¼Œé¿å…å¤§ç›®æ ‡è¯¯å·®ä¸»å¯¼è®­ç»ƒã€‚

ä¼˜åŒ–æ¢¯åº¦ï¼Œä½¿ä¼˜åŒ–è¿‡ç¨‹æ›´ç¨³å®šã€‚

ç‰©ç†æ„ä¹‰æ¸…æ™°ï¼Œç›´æŽ¥é¢„æµ‹ç›¸å¯¹äºŽé”šæ¡†çš„ç¼©æ”¾æ¯”ä¾‹ï¼Œç¬¦åˆé”šæ¡†æœºåˆ¶çš„è®¾è®¡æ€æƒ³ã€‚

è¿™æ˜¯ä¸€ç§åœ¨ç›®æ ‡æ£€æµ‹é¢†åŸŸè¢«å¹¿æ³›éªŒè¯æœ‰æ•ˆçš„å·¥ç¨‹å®žè·µå’Œæ•°å­¦æŠ€å·§ã€‚ðŸ§ 

è¡¥å……è¯´æ˜Žï¼šè™½ç„¶é€šå¸¸ä½¿ç”¨è‡ªç„¶å¯¹æ•°ï¼ˆln æˆ– logï¼‰ï¼Œä½†ç†è®ºä¸Šå…¶ä»–åº•æ•°çš„å¯¹æ•°ï¼ˆå¦‚ log2, log10ï¼‰ä¹Ÿèƒ½è¾¾åˆ°ç±»ä¼¼åŽ‹ç¼©åŠ¨æ€èŒƒå›´çš„æ•ˆæžœã€‚è‡ªç„¶å¯¹æ•°å› å…¶åœ¨æ•°å­¦å’Œä¼˜åŒ–ä¸­çš„æ™®éæ€§è€Œè¢«æœ€å¸¸ä½¿ç”¨ã€‚